---
locale: ja
prev: "content-types.md"
next: "schema-diagrams.md"
---

# プライバシー

Arweaveのブロックウィーブは本質的に公開されています。しかし、ArFSのようなアプリケーションを使用することで、ユーザーのプライベートデータは軍用レベルの（[量子耐性](https://blog.boot.dev/cryptography/is-aes-256-quantum-resistant/#:~:text=Symmetric%20encryption%2C%20or%20more%20specifically,key%20sizes%20are%20large%20enough)）暗号化を用いてコンピュータから外部に出ることはありません。このプライバシーレイヤーはドライブレベルで適用され、ユーザーはドライブを最初に作成する際にそれがパブリックかプライベートかを決定します。プライベートドライブはArFSプライバシーモデルに従う必要があります。

プライベートドライブ内のすべてのファイルは、[AES-256-GCM](https://iopscience.iop.org/article/10.1088/1742-6596/1019/1/012008/pdf)を使用して対称的に暗号化されます。各プライベートドライブには「ドライブキー」と呼ばれるマスターキーがあり、これはユーザーのArweaveウォレット署名、ユーザー定義のドライブパスワード、および一意のドライブ識別子（[uuidv4](https://en.wikipedia.org/wiki/Universally_unique_identifier)）を組み合わせたものです。各ファイルにはその「ドライブキー」から派生した独自の「ファイルキー」があります。これにより、他のファイルへのアクセスを公開せずに、単一のファイルを共有することができます。

ファイルが暗号化され、Arweaveに保存されると、それは永遠にロックされ、そのファイルキーを使用してのみ復号化できます。

## キーの派生

プライベートドライブには、暗号化用のグローバルドライブキー `D` と複数のファイルキー `F` があります。これにより、ドライブには必要なだけ多くのユニークに暗号化されたファイルを持つことができます。1つのキーは、単一のファイルのすべてのバージョンに使用されます（新しいファイルバージョンは同じFile-Idを使用します）。

`D` はドライブとフォルダーのメタデータを暗号化するために使用され、`F` はファイルのメタデータと実際の保存データを暗号化するために使用されます。これにより、ユーザーは特定のファイルを共有することができ、ドライブ全体の内容を明らかにすることなく利用できます。

`D` は、ドライブのIDとユーザーが提供するパスワードのRSA-PSS署名を使用してHKDF-SHA256で派生します。

`F` もHKDF-SHA256を使用してドライブキーとファイルのIDから派生します。

<img :src="$withBase('/encryption-diagram.png')" style="height: auto; display: block; margin-left: auto; margin-right: auto; width: 75%;">

他のウォレット（[ArConnect](https://www.arconnect.io/)など）は、このキー派生プロトコルに統合されており、ドライブキーを得るために必要なSHA-256署名を取得するために指定されたArweaveウォレットから署名を収集するAPIを公開しています。

Dartを使用した実装の例は[こちら](https://github.com/ardriveapp/ardrive-web/blob/187b3fb30808bda452123c2b18931c898df6a3fb/docs/private_drive_kdf_reference.dart)で入手でき、Typescriptの実装は[こちら](https://github.com/ardriveapp/ardrive-core-js/blob/f19da30efd30a4370be53c9b07834eae764f8535/src/utils/crypto.ts)にあります。

## プライベートドライブ

ドライブはパブリックまたはプライベートデータを保存できます。これはドライブエンティティメタデータの `Drive-Privacy` タグによって示されます。


```json
Drive-Privacy: "<public | private>"
```

ドライブエンティティがプライベートである場合、追加のタグ `Drive-Auth-Mode` も使用して、ドライブキーの派生方法を示す必要があります。ArDriveクライアントは現在、安全なパスワードとArweaveウォレットのプライベートキー署名を使用してグローバルドライブキーを派生させています。

```json
Drive-Auth-Mode?: 'password'
```

すべての暗号化されたドライブエンティティには、データを復号化するための公開パラメータとともに `Cipher` タグが指定される必要があります。これは、パラメータを `Cipher-*` タグで指定することで行われます。例えば `Cipher-IV`です。パラメータがバイトデータの場合、タグ内ではBase64でエンコードする必要があります。

ArDriveクライアントは、すべての対称暗号化にAES256-GCMを利用しており、これには12バイトのランダムなデータからなるCipher Initialization Vectorが必要です。

```json
Cipher?: "AES256-GCM"
Cipher-IV?: "<12 byte initialization vector as Base64>"
```

さらに、すべての暗号化されたトランザクションは、メタデータとデータトランザクションの両方で `Content-Type` タグを `application/octet-stream` に設定する必要があります。

プライベートドライブエンティティとそれに対応するルートフォルダーエンティティは、トランザクションに含まれるJSONファイルを対称的に暗号化するために生成されたこれらのキーと暗号を使用します。これにより、ドライブの所有者（およびキーが共有された者）のみがドライブを開き、ルートフォルダーを発見し、ドライブ内の残りの子要素を読み込むことができます。

## プライベートファイル

プライベートドライブにファイルがアップロードされると、それもデフォルトでプライベートになり、その親ドライブと同じドライブキーを利用します。ドライブ内の各ユニークなファイルには、そのファイルのユニークな `FileId` に基づいた独自のファイルキーのセットが与えられます。単一のファイルが新しいバージョンを取得すると、その `File-Id` は再利用され、そのファイルの履歴内のすべてのバージョンに同じファイルキーを効果的に利用します。

これらのファイルキーは、ドライブの所有者が必要に応じて共有できます。

プライベートファイルエンティティは、メタデータおよびデータトランザクションの両方が同じファイルキーを使用して暗号化されており、データのすべての側面が本当にプライベートであることを保証します。そのため、ファイルのメタデータとデータトランザクションの両方には、一意の `Cipher-IV` と `Cipher` タグが必要です。

```json
Cipher?: "AES256-GCM"
Cipher-IV?: "<12 byte initialization vector as Base64>"
```

ドライブと同様に、プライベートファイルはメタデータおよびデータトランザクションの両方で `Content-Type` タグを `application/octet-stream` に設定する必要があります。

```json
Content-Type: "application/octet-stream"
```